---
title: 'ğŸš© Chap 4.1: Sá»­ Dá»¥ng Effect Hook'
publishedAt: '2020-11-19'
summary: 'Effect hook lÃ  má»™t thá»© ráº¥t thÃº vá»‹, nÃ³ nhÆ° cÃ  phÃª 3 trong 1 váº­y.'
image: '/static/images/chap41-su-dung-effect-hook/useEffectHook.png'
---

<!-- ![useEffect](https://daveceddia.com/images/useEffect-hook.png) -->

![useEffect](/static/images/chap41-su-dung-effect-hook/useEffectHook.png)

Effect Hook cho phÃ©p thá»±c hiá»‡n side effect bÃªn trong cÃ¡c function component âœŒï¸

### 1. Táº¡o Má»™t useEffect:

```jsx
// TÆ°Æ¡ng tá»± nhÆ° componentDidMount vÃ  componentDidUpdate:
useEffect(() => {
  // Cáº­p nháº­p document title sá»­ dá»¥ng browser API
  document.title = `You clicked ${count} times`;
});
```

Viá»‡c fetching data, thiáº¿t láº­p cÃ¡c subscription, vÃ  viá»‡c thay Ä‘á»•i DOM trong React component, nhá»¯ng hÃ nh Ä‘á»™ng nhÆ° váº­y Ä‘Æ°á»£c gá»i lÃ  â€œside effectâ€ (hoáº·c â€œeffect). Báº¡n cÃ³ thá»ƒ Ä‘Ã£ sá»­ dá»¥ng nhá»¯ng â€œside effectâ€ nÃ y trong nhá»¯ng component cá»§a báº¡n trÆ°á»›c Ä‘Ã¢y.

CÃ³ hai loáº¡i Effect lÃ  loáº¡i cáº§n cleanup vÃ  loáº¡i khÃ´ng cáº§n cleanup. BÃ¢y giá» mÃ¬nh sáº½ láº§n lÆ°á»£t nÃ³i vá» hai loáº¡i nÃ y.

### 2. Effect KhÃ´ng Cáº§n Cleanup:

ÄÃ´i lÃºc, chÃºng ta muá»‘n cháº¡y má»™t vÃ i Ä‘oáº¡n code sau khi React Ä‘Ã£ cáº­p nháº­p DOM. Network request, tá»± Ã½ thay Ä‘á»•i DOM, vÃ  logging lÃ  nhá»¯ng vÃ­ dá»¥ Ä‘iá»ƒn hÃ¬nh cá»§a effect khÃ´ng cáº§n cleanup. ChÃºng ta gá»i nhÆ° váº­y vÃ¬ cÃ³ thá»ƒ cháº¡y chÃºng vÃ  quÃªn ngay láº­p tá»©c.
**VÃ­ dá»¥ nhÆ° hiá»‡n sá»‘ láº§n Ä‘áº¿m lÃªn document title:**

```jsx
import React, { useState, useEffect } from 'react';

function Example() {
  const [count, setCount] = useState(0);

  useEffect(() => {
    document.title = `You clicked ${count} times`;
  });

  return (
    <div>
      <p>You clicked {count} times</p>
      <button onClick={() => setCount(count + 1)}>Click me</button>
    </div>
  );
}
```

**ChuyÃªn má»¥c há»i xoÃ¡y Ä‘Ã¡p lÃ²ng vÃ²ng :**

- **useEffect nÃ³ Ä‘Ã£ lÃ m gÃ¬ váº­y?**
  NÃ³ nÃ³i vá»›i React ráº±ng component cáº§n lÃ m cÃ¡i gÃ¬ Ä‘Ã³ sau khi render. React sáº½ nhá»› hÃ m truyá»n vÃ o vÃ  sau khi render nÃ³ sáº½ gá»i hÃ m Ä‘Ã³ (Ä‘Ã³ gá»i lÃ  Effect). Trong effect nÃ y, chÃºng ta Ä‘á»•i document title, chÃºng ta cÅ©ng cÃ³ thá»ƒ fetch data hoáº·c gá»i má»™t sá»‘ API khÃ¡c.

- **Táº¡i sao useEffect Ä‘Æ°á»£c gá»i bÃªn trong component?**
  VÃ¬ Ä‘á»ƒ nÃ³ cÃ³ thá»ƒ truy xuáº¥t Ä‘áº¿n state count hoáº·c báº¥t kÃ¬ props nÃ o. Hook táº­n dá»¥ng JavaScript closures, effect váº«n náº±m trong scope cá»§a Function. LÃ  hÃ ng ná»™i bá»™.

- **useEffect cháº¡y sau táº¥t cáº£ nhá»¯ng láº§n render?**
  ÄÃºng , máº·c Ä‘á»‹nh lÃ  sau láº§n Ä‘áº§u tiÃªn, vÃ  sau Ä‘Ã³ lÃ  cÃ¡c láº§n update. NhÆ°ng chÃºng ta cÃ³ thá»ƒ custom láº¡i nÃ³ theo cÃ¡c má»¥c Ä‘Ã­ch cá»§a chÃºng ta.

**Giá» Ä‘i sÃ¢u cá»¥ thá»ƒ hÆ¡n chÃºt**

```jsx
function Example() {
  const [count, setCount] = useState(0);

  useEffect(() => {
    document.title = `You clicked ${count} times`;
  });
}
```

ChÃºng ta khai bÃ¡o state `count`, vÃ  sau Ä‘Ã³ nÃ³i vá»›i React chÃºng ta cáº§n sá»­ dá»¥ng. ChÃºng ta truyá»n cho `useEffect` má»™t hÃ m. HÃ m truyá»n vÃ o nÃ y lÃ  effect.
BÃªn trong effect, chÃºng ta Ä‘áº·t document title sá»­ dá»¥ng API `document.title`. ChÃºng ta cÃ³ thá»ƒ Ä‘á»c giÃ¡ trá»‹ sau cÃ¹ng cá»§a count bÃªn trong effect bá»Ÿi vÃ¬ nÃ³ náº±m chung scope vá»›i function. Khi React render component, nÃ³ sáº½ nhá»› láº¡i effect chÃºng ta Ä‘Ã£ gá»­i, vÃ  cháº¡y effect sau khi cáº­p nháº­t DOM. NÃ³ xáº£y ra á»Ÿ táº¥t cáº£ cÃ¡c láº§n render, ká»ƒ cáº£ láº§n Ä‘áº§u.

### 3. Effect Cáº§n Cleanup:

á» trÃªn lÃ  cÃ¡c effect khÃ´ng cáº§n clean nhÆ°ng má»™t sá»‘ trÆ°á»ng há»£p effect cáº§n cÃ³. VÃ­ dá»¥, chÃºng ta muá»‘n thiáº¿t láº­p cÃ¡c subscription cho vÃ i data source bÃªn ngoÃ i. TÃ¬nh huá»‘ng Ä‘Ã³, clean up lÃ  ráº¥t quan trá»ng Ä‘á»ƒ khÃ´ng xáº£y ra memory leak!

á» bÃªn Class chÃºng ta cÃ³ hai menthod `componentDidMount` vÃ  `componentWillUnmount` Ä‘á»ƒ thá»ƒ hiá»‡n viá»‡c cáº­p nháº­t vÃ  clear data. CÃ²n bÃªn hook thÃ¬ sao ?

```jsx
function FriendStatus(props) {
  const [isOnline, setIsOnline] = useState(null);

  useEffect(() => {
    function handleStatusChange(status) {
      setIsOnline(status.isOnline);
    }
    ChatAPI.subscribeToFriendStatus(props.friend.id, handleStatusChange);
    // Chá»‰ Ä‘á»‹nh clean up sau khi gá»i effect:
    return function cleanup() {
      ChatAPI.unsubscribeFromFriendStatus(props.friend.id, handleStatusChange);
    };
  });

  if (isOnline === null) {
    return 'Loading...';
  }
  return isOnline ? 'Online' : 'Offline';
}
```

**Há»i tiáº¿p:**

- **Táº¡i sao chÃºng ta tráº£ vá» function bÃªn trong effect?**
  ÄÃ¢y lÃ  má»™t tuá»³ chá»n Ä‘á»ƒ cháº¡y cÆ¡ cháº¿ clean cho effect. NÃ³ cho phÃ©p chÃºng ta Ä‘Æ°a táº¡o vÃ  xÃ³a subscription trong cÃ¹ng má»™t effect. Ok con dÃª?

- **Khi nÃ o React clean up má»™t effect?**
  React thá»±c hiá»‡n cleanup khi component unmount

### ğŸ“– TÃ³m Láº¡i LÃ  :

ChÃºng ta Ä‘Ã£ biáº¿t useEffect cho phÃ©p chÃºng ta thá»±c hiá»‡n nhiá»u kiá»ƒu side effect sau khi component Ä‘Æ°á»£c render. Má»™t vÃ i effect cáº§n cleanup nÃ³ sáº½ return má»™t function:

```jsx
useEffect(() => {
  function handleStatusChange(status) {
    setIsOnline(status.isOnline);
  }

  ChatAPI.subscribeToFriendStatus(props.friend.id, handleStatusChange);
  return () => {
    ChatAPI.unsubscribeFromFriendStatus(props.friend.id, handleStatusChange);
  };
});
```

Má»™t vÃ i effect khÃ¡c cÃ³ thá»ƒ khÃ´ng cáº§n cleanup, thÃ¬ khÃ´ng cáº§n return gÃ¬ cáº£.

```jsx
useEffect(() => {
  document.title = `You clicked ${count} times`;
});
```

BÃ i hÃ´m nay tá»›i Ä‘Ã¢y thÃ´i, cáº£m Æ¡n má»i ngÆ°á»i, bÃ i sau mÃ¬nh viáº¿t tiáº¿p ba cháº¿ Ä‘á»™ sá»­ dá»¥ng effect nhe. ğŸ˜Š
